<pre id="stlog-1" style="font-size: 11px" class="sthlp">-----------------------------------------------------------------------------------------------------------------------------------------------------------------
<b>help ddml</b>                                                                                                                                                    v1.2
-----------------------------------------------------------------------------------------------------------------------------------------------------------------

<b><u>Title</u></b>

    <b>qddml</b> --      Stata program for Double Debiased Machine Learning

    <b>ddml</b> implements algorithms for causal inference aided by supervised machine learning as proposed in <i>Double/debiased machine learning for treatment and</i>
    <i>structural parameters</i> (Econometrics Journal, 2018). Five different models are supported, allowing for binary or continous treatment variables and
    endogeneity, high-dimensional controls and/or instrumental variables.  <b>ddml</b> supports a variety of different ML programs, including but not limited to 
    <a href="http://www.stata.com/help.cgi?lassopack"><b>lassopack</b></a> and <a href="http://www.stata.com/help.cgi?pystacked"><b>pystacked</b></a>.

    <b>qddml</b> is a wrapper program of <b>ddml</b>. It provides a convenient one-line syntax with almost the full flexibility of <b>ddml</b>.  The main restriction of <b>qddml</b> is
    that it only allows to be used with one machine learning program at the time, while <b>ddml</b> allow for multiple learners per reduced form equation.

    <b>qddml</b> uses stacking regression (<a href="http://www.stata.com/help.cgi?pystacked"><b>pystacked</b></a>) as the default machine learning program.

    <b>qddml</b> relies on <a href="http://www.stata.com/help.cgi?crossfit"><b>crossfit</b></a>, which can be used as a standalone program.

        <b>qddml</b> <i>depvar</i> <i>regressors</i> [<b>(</b><i>hd_controls</i><b>)</b>] <b>(</b><i>endog</i><b>=</b><i>instruments</i><b>)</b> [<b>if</b> <i>exp</i>] [<b>in</b> <i>range</i>] <b>model(</b><i>name</i><b>)</b> [ <b>,</b> <b>cmd(</b><i>string</i><b>)</b> <b>cmdopt(</b><i>string</i><b>)</b> <b>mname(</b><i>string</i><b>)</b> <b>noreg</b> <b>...</b> ]}

    Since <b>qddml</b> uses <a href="http://www.stata.com/help.cgi?pystacked"><b>pystacked</b></a> per default, it requires Stata 16 or higher, Python 3.x and at least scikit-learn 0.24. See <a href="http://www.stata.com/help.cgi?python"><b>this help file</b></a>, this Stata blog
    entry and this Youtube video for how to set up Python on your system.  In short, install Python 3.x (we recommend Anaconda) and set the appropriate Python
    path using <b>python set exec</b>.  If you don't have Stata 16+, you can still use <b>pystacked</b> with programs that don't rely on Python, e.g., using the option
    <b>cmd(</b><i>rlasso</i><b>)</b>.

    Please check the <a href="#stlog-1-examples"><b>examples</b></a> provided at the end of the help file.

<a name="stlog-1-syntax"></a><b><u>Options</u></b>

    <i>General</i>               Description
    -----------------------------------------------------------------------------------------------------------------------------------------------------------
    <b>model(</b><i>name</i><b>)</b>            the model to be estimated; allows for <i>partial</i>, <i>interactive</i>, <i>iv</i>, <i>fiv</i>, <i>late</i>. See <a href="http://www.stata.com/help.cgi?ddml#models"><b>here</b></a> for an overview.
    <b>mname(</b><i>string</i><b>)</b>          name of the DDML model. Allows to run multiple DDML models simultaneously. Defaults to <i>m0</i>.
    <b>kfolds(</b><i>integer</i><b>)</b>        number of cross-fitting folds. The default is 5.
    <b>fcluster(</b><i>varname</i><b>)</b>      cluster identifiers for cluster randomization of random folds.
    <b>foldvar(</b><i>varname</i><b>)</b>       integer variable with user-specified cross-fitting folds.
    <b>reps(</b><i>integer</i><b>)</b>          number of re-sampling iterations, i.e., how often the cross-fitting procedure is repeated on randomly generated folds.
    <b>shortstack</b>             asks for short-stacking to be used.  Short-stacking runs contrained non-negative least squares on the cross-fitted predicted values
                            to obtain a weighted average of several base learners.
    <b><u>r</u></b><b>obust</b>                 report SEs that are robust to the presence of arbitrary heteroskedasticity.
    <b>vce(</b><i>type</i><b>)</b>              select variance-covariance estimator, see <a href="http://www.stata.com/help.cgi?regress#vcetype"><b>here</b></a>
    <b>cluster(</b><i>varname</i><b>)</b>       select cluster-robust variance-covariance estimator.
    <b>noreg</b>                  do not add <a href="http://www.stata.com/help.cgi?regress"><b>regress</b></a> as an additional learner.

    <i>Learners</i>              Description
    -----------------------------------------------------------------------------------------------------------------------------------------------------------
    <b>cmd(</b><i>string</i><b>)</b>            ML program used for estimating conditional expectations.  Defaults to <a href="http://www.stata.com/help.cgi?pystacked"><b>pystacked</b></a>.  See <a href="http://www.stata.com/help.cgi?ddml#compatibility"><b>here</b></a> for other supported programs.
    <b>ycmd(</b><i>string</i><b>)</b>           ML program used for estimating the conditional expectations of the outcome <i>Y</i>.  Defaults to <b>cmd(</b><i>string</i><b>)</b>.
    <b>dcmd(</b><i>string</i><b>)</b>           ML program used for estimating the conditional expectations of the treatment variable(s) <i>D</i>.  Defaults to <b>cmd(</b><i>string</i><b>)</b>.
    <b>zcmd(</b><i>string</i><b>)</b>           ML program used for estimating conditional expectations of instrumental variable(s) <i>Z</i>.  Defaults to <b>cmd(</b><i>string</i><b>)</b>.
    <b>*cmdopt(</b><i>string</i><b>)</b>        options that are passed on to ML program.  The asterisk <b>*</b> can be replaced with either nothing (setting the default for all reduced
                            form equations), <b>y</b> (setting the default for the conditional expectation of <i>Y</i>), <b>d</b> (setting the default for <i>D</i>) or <b>z</b> (setting the
                            default for <i>Z</i>).
    <b>*vtype(</b><i>string</i><b>)</b>         variable type of the variable to be created. Defaults to <i>double</i>.  <i>none</i> can be used to leave the type field blank (this is required
                            when using <b>ddml</b> with <a href="http://www.stata.com/help.cgi?rforest"><b>rforest</b></a>.) The asterisk <b>*</b> can be replaced with either nothing (setting the default for all reduced form
                            equations), <b>y</b> (setting the default for the conditional expectation of <i>Y</i>), <b>d</b> (setting the default for <i>D</i>) or <b>z</b> (setting the default
                            for <i>Z</i>).
    <b>*predopt(</b><i>string</i><b>)</b>       <b>predict</b> option to be used to get predicted values.  Typical values could be <b>xb</b> or <b>pr</b>. Default is blank. The asterisk <b>*</b> can be
                            replaced with either nothing (setting the default for all reduced form equations), <b>y</b> (setting the default for the conditional
                            expectation of <i>Y</i>), <b>d</b> (setting the default for <i>D</i>) or <b>z</b> (setting the default for <i>Z</i>).

    <i>Output</i>                Description
    -----------------------------------------------------------------------------------------------------------------------------------------------------------
    <b><u>verb</u></b><b>ose</b>                show detailed output
    <b><u>vverb</u></b><b>ose</b>               show even more output

<a name="stlog-1-models"></a><b><u>Models</u></b>

    See <a href="http://www.stata.com/help.cgi?ddml#models"><b>here</b></a>.

<a name="stlog-1-compatibility"></a><b><u>Compatible programs</u></b>

    See <a href="http://www.stata.com/help.cgi?ddml#compatibility"><b>here</b></a>.

<a name="stlog-1-examples"></a><b><u>Examples</u></b>

    Below we demonstrate the use of <b>qddml</b> for each of the 5 models supported.  Note that estimation models are chosen for demonstration purposes only and kept
    simple to allow you to run the code quickly.  Please also see the examples in the <a href="http://www.stata.com/help.cgi?ddml#examples"><b>ddml help file</b></a>

    <u>Partially linear model.</u>

    Preparations: we load the data, define global macros and set the seed.
        . use https://github.com/aahrens1/ddml/raw/master/data/sipp1991.dta, clear
        . global Y net_tfa
        . global D e401
        . global X tw age inc fsize educ db marr twoearn pira hown
        . set seed 42

    The options <b>model(partial)</b> selects the partially linear model and <b>kfolds(2)</b> selects two cross-fitting folds.  We use the options <b>cmd()</b> and <b>cmdopt()</b> to
    select random forest for estimating the conditional expectations.

    Note that we set the number of random folds to 2, so that the model runs quickly. The default is <b>kfolds(</b><i>5</i><b>)</b>. We recommend to consider at least 5-10 folds
    and even more if your sample size is small.

    Note also that we recommend to re-run the model multiple time on different random folds, see options <b>reps(</b><i>integer</i><b>)</b>.

        . qddml $Y $D ($X), kfolds(2) model(partial) cmd(pystacked) cmdopt(type(reg) method(rf))

    <u>Partially linear IV model.</u>

    Preparations: we load the data, define global macros and set the seed.
        . use https://statalasso.github.io/dta/AJR.dta, clear
        . global Y logpgp95
        . global D avexpr
        . global Z logem4
        . global X lat_abst edes1975 avelf temp* humid* steplow-oilres
        . set seed 42

    Since the data set is very small, we consider 30 cross-fitting folds.
 
    We need to add the option <b>vtype(</b><i>none</i><b>)</b> for <a href="http://www.stata.com/help.cgi?rforest"><b>rforest</b></a> to work with <b>ddml</b> since <a href="http://www.stata.com/help.cgi?rforests"><b>rforests</b></a>'s <b>predict</b> command doesn't support variable types.

        . qddml $Y ($X) ($D=$Z), kfolds(30) model(iv) cmd(rforest) cmdopt(type(reg)) vtype(none) robust

    <u>Interactive model--ATE and ATET estimation.</u>

    Preparations: we load the data, define global macros and set the seed.
        . webuse cattaneo2, clear
        . global Y bweight
        . global D mbsmoke
        . global X mage prenatal1 mmarried fbaby mage medu
        . set seed 42

    Note that we use gradient boosted regression trees for E[Y|X,D] (see <b>ycmdopt()</b>), but gradient boosted classification trees for E[D|X] (see <b>dcmdopt()</b>).
 
        . qddml $Y $D ($X), kfolds(5) reps(5) model(interactive) cmd(pystacked) ycmdopt(type(reg) method(gradboost)) dcmdopt(type(class) method(gradboost))

    <b>qddml</b> reports the ATE effect by default. The option <b>atet</b> returns the ATET estimate.

    If we want retrieve the ATET estimate after estimation, we can simply use {ddml estimate}.
        . ddml estimate, atet

    <u>Interactive IV model--LATE estimation.</u>

    Preparations: we load the data, define global macros and set the seed.
        . use http://fmwww.bc.edu/repec/bocode/j/jtpa.dta,clear
        . global Y earnings
        . global D training
        . global Z assignmt
        . global X sex age married black hispanic
        . set seed 42

        . qddml $Y (c.($X)# #c($X)) ($D=$Z), kfolds(5) model(interactiveiv) cmd(pystacked) ycmdopt(type(reg) m(lassocv)) dcmdopt(type(class) m(lassocv))
            zcmdopt(type(class) m(lassocv))

    <u>Flexible Partially Linear IV model.</u>

    Preparations: we load the data, define global macros and set the seed.
        . use https://github.com/aahrens1/ddml/raw/master/data/BLP.dta, clear
        . global Y share
        . global D price
        . global X hpwt air mpd space
        . global Z sum*
        . set seed 42

    The syntax is the same as in the Partially Linear IV model, but we now estimate the optimal instrument flexibly.
        . qddml $Y ($X) ($D=$Z), model(fiv)

<a name="stlog-1-references"></a><b><u>References</u></b>

    Chernozhukov, V., Chetverikov, D., Demirer, M., Duflo, E., Hansen, C., Newey, W. and Robins, J. (2018), Double/debiased machine learning for treatment and
    structural parameters.  <i>The Econometrics Journal</i>, 21: C1-C68. https://doi.org/10.1111/ectj.12097

<a name="stlog-1-installation"></a><b><u>Installation</u></b>

    To get the latest stable version of <b>ddml</b> from our website, check the installation instructions at https://statalasso.github.io/installation/.  We update
    the stable website version more frequently than the SSC version.

    To verify that <b>ddml</b> is correctly installed, click on or type whichpkg ddml (which requires <a href="http://www.stata.com/help.cgi?whichpkg"><b>whichpkg</b></a> to be installed; ssc install whichpkg).

<b><u>Authors</u></b>

    Achim Ahrens, Public Policy Group, ETH Zurich, Switzerland
    achim.ahrens@gess.ethz.ch

    Christian B. Hansen, University of Chicago, USA
    Christian.Hansen@chicagobooth.edu

    Mark E Schaffer, Heriot-Watt University, UK
    m.e.schaffer@hw.ac.uk

    Thomas Wiemann, University of Chicago, USA
    wiemann@uchicago.edu

<b><u>Also see (if installed)</u></b>

    Help: <a href="http://www.stata.com/help.cgi?lasso2"><b>lasso2</b></a>, <a href="http://www.stata.com/help.cgi?cvlasso"><b>cvlasso</b></a>, <a href="http://www.stata.com/help.cgi?rlasso"><b>rlasso</b></a>, <a href="http://www.stata.com/help.cgi?ivlasso"><b>ivlasso</b></a>, <a href="http://www.stata.com/help.cgi?pdslasso"><b>pdslasso</b></a>, <a href="http://www.stata.com/help.cgi?pystacked"><b>pystacked</b></a>.
</pre>
