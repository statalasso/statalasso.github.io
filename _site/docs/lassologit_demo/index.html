<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.11.1 by Michael Rose
  Copyright 2013-2018 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE.txt
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Example using Spam data - The Stata Lasso Page</title>
<meta name="description" content="The Stata Lasso Page.">



<meta property="og:type" content="website">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="The Stata Lasso Page">
<meta property="og:title" content="Example using Spam data">
<meta property="og:url" content="http://localhost:4000/docs/lassologit_demo/">












  

  


<link rel="canonical" href="http://localhost:4000/docs/lassologit_demo/">







  <script type="application/ld+json">
    {
      "@context": "http://schema.org",
      "@type": "Person",
      "name": "Achim Ahrens",
      "url": "http://localhost:4000",
      "sameAs": null
    }
  </script>







<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="The Stata Lasso Page Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if lte IE 9]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->


    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    <div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        <a class="site-title" href="/">The Stata Lasso Page</a>
        <ul class="visible-links">
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/" >Home</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/installation/" >Installation</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/slides/" >Slides</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/papers/" >Working paper</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/about/" >About</a>
            </li>
          
            
            <li class="masthead__menu-item">
              <a href="http://localhost:4000/references/" >References</a>
            </li>
          
        </ul>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle Menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>

    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  
  
    
      
      
      
    
    
      

<nav class="nav__list">
  
  <input id="ac-toc" name="accordion-toc" type="checkbox" />
  <label for="ac-toc">Toggle Menu</label>
  <ul class="nav__items">
    
      <li>
        
          <span class="nav__sub-title">lassopack</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docs/lassopack/" class="">Overview</a></li>
          
            
            

            
            

            <li><a href="/docs/regularized_reg/" class="">Regularized regression</a></li>
          
            
            

            
            

            <li><a href="/docs/estimators/" class="">Estimation methods</a></li>
          
            
            

            
            

            <li><a href="/docs/lasso2/" class="">Getting started (lasso2)</a></li>
          
            
            

            
            

            <li><a href="/docs/cvlasso/" class="">Cross-validation (cvlasso)</a></li>
          
            
            

            
            

            <li><a href="/docs/rlasso/" class="">Rigorous lasso (rlasso)</a></li>
          
            
            

            
            

            <li><a href="/docs/lasso2_help/" class="">Help lasso2</a></li>
          
            
            

            
            

            <li><a href="/docs/cvlasso_help/" class="">Help cvlasso</a></li>
          
            
            

            
            

            <li><a href="/docs/rlasso_help/" class="">Help rlasso</a></li>
          
            
            

            
            

            <li><a href="/docs/lassopack_cite/" class="">Citation</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">pdslasso</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docs/pdslasso/" class="">Overview</a></li>
          
            
            

            
            

            <li><a href="/docs/pdslasso_models/" class="">Models</a></li>
          
            
            

            
            

            <li><a href="/docs/pdslasso_demo/" class="">Demonstration</a></li>
          
            
            

            
            

            <li><a href="/docs/ivlasso_help/" class="">Help file</a></li>
          
            
            

            
            

            <li><a href="/docs/pdslasso_cite/" class="">Citation</a></li>
          
        </ul>
        
      </li>
    
      <li>
        
          <span class="nav__sub-title">lassologit</span>
        

        
        <ul>
          
            
            

            
            

            <li><a href="/docs/lassologit/" class="">Overview</a></li>
          
            
            

            
            

            <li><a href="/docs/lassologit_demo/" class="active">Demonstration</a></li>
          
            
            

            
            

            <li><a href="/docs/lassologit_help/" class="">Help file</a></li>
          
            
            

            
            

            <li><a href="/docs/lassologit_cite/" class="">Citation</a></li>
          
        </ul>
        
      </li>
    
  </ul>
</nav>
    
  
  </div>


  <article class="page" itemscope itemtype="http://schema.org/CreativeWork">
    <meta itemprop="headline" content="Example using Spam data">
    
    
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Example using Spam data
</h1>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
        <script type="text/javascript" async="" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
</script>

<p>For demonstration we consider the <a href="https://archive.ics.uci.edu/ml/datasets/spambase">Spambase Data Set</a>
from the Machine Learning Repository.  The data set
includes 4,601 observations and 57 variables.  The aim is
to predict if an email is spam (i.e., unsolicited commercial e-mail) or
not.  Each observation corresponds to one email.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Predictors    
  v1-v48    percentage of words in the e-mail that match a specific word, i.e.
              100 * (number of times the word appears in the e-mail) divided by
              total number of words in e-mail.  To see which word each predictor
              corresponds to, see link below.
  v49-v54   percentage of characters in the e-mail that match a specific
              character, i.e. 100 * (number of times the character appears in
              the e-mail) divided by total number of characters in e-mail.  To
              see which character each predictor corresponds to, see link below.
  v55       average length of uninterrupted sequences of capital letters
  v56       length of longest uninterrupted sequence of capital letters
  v57       total number of capital letters in the e-mail

Outcome       
  v58       denotes whether the e-mail was considered spam (1) or not (0).
</code></pre></div></div>

<h2 id="load-spam-data">Load spam data</h2>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. insheet using https://archive.ics.uci.edu/ml/machine-learning-databases/spambase/spambase.data, clear comma
</code></pre></div></div>

<h2 id="introduction-to-lassologit">Introduction to lassologit</h2>

<p>The basic syntax for lassologit is to specify the dependent variable followed by
a list of predictors:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. lassologit v58 v1-v57
</code></pre></div></div>

<p>The output of lassologit shows the penalty levels (<code class="highlighter-rouge">lambda</code>), the number of
predictors included (<code class="highlighter-rouge">s</code>), the <script type="math/tex">\ell_1</script> norm, one information criterion (<script type="math/tex">EBIC</script> by
default), McFadden’s Pseudo-<script type="math/tex">R^2</script> and, in the last column,
 which predictors are included/removed
from the model.</p>

<p>By default, one line per <em>knot</em> is shown. Knots are points at which predictors
enter or leave the model.</p>

<p>To obtain the logistic lasso estimate for a user-specified
 scalar lambda or a list of lambdas,
the <code class="highlighter-rouge">lambda(numlist)</code> option can be used.
Note that output and the objects stored in <code class="highlighter-rouge">e()</code> depend on whether lambda is only
one value or a list of more than one value.</p>

<h2 id="information-criteria">Information criteria</h2>

<p>To estimate the model selected by one of the information criteria, use the <code class="highlighter-rouge">lic()</code>
option:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. lassologit v58 v1-v57
. lassologit, lic(ebic)
. lassologit, lic(aicc)
</code></pre></div></div>

<p>In the above example, we use the replay syntax that works similar to a
post-estimation command.  <code class="highlighter-rouge">lassologit</code> reports the logistic lasso estimates and the
post-logit estimates (from applying logit estimation to the model selected by
the logitistic lasso) for the value of lambda selected by the specified
information criterion.</p>

<p><strong>NB:</strong> <code class="highlighter-rouge">lic()</code> does not change the estimation results in memory. The advantage
is that this way <code class="highlighter-rouge">lic()</code> can be used multiple times to compare results without
that we need to re-estimate the model.</p>

<p>To store the model selected by one of the information criteria, 
add <code class="highlighter-rouge">postresults</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. lassologit, lic(ebic) postresults
</code></pre></div></div>

<h2 id="cross-validation-with-cvlassologit">Cross-validation with cvlassologit</h2>

<p><code class="highlighter-rouge">cvlassologit</code> implements <script type="math/tex">K</script>-fold cross-validation where the data is by default
randomly partitioned.</p>

<p>Here, we use <script type="math/tex">K=3</script> and <code class="highlighter-rouge">seed(123)</code> to set the seed for reproducibility.  (Be
patient, this takes a minute.)</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. cvlassologit v58 v1-v57, nfolds(3) seed(123)
</code></pre></div></div>

<p>The output shows the prediction performance measured by deviance for each <script type="math/tex">\lambda</script>
value.  To estimate the model selected by cross-validation we can specify <code class="highlighter-rouge">lopt</code>
or <code class="highlighter-rouge">lse</code> using the replay syntax.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. cvlassologit, lopt
. cvlassologit, lse
</code></pre></div></div>

<h2 id="rigorous-penalization-with-rlassologit">Rigorous penalization with rlassologit</h2>

<p>Lastly, we consider the logistic lasso with rigorous penalization:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. rlassologit v58 v1-v57
</code></pre></div></div>

<p><code class="highlighter-rouge">rlassologit</code> displays the logistic lasso solution and the post-logit solution.</p>

<p>The rigorous lambda is returned in <code class="highlighter-rouge">e(lambda)</code> and, in this example, is equal to <code class="highlighter-rouge">79.207801</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. di e(lambda)
</code></pre></div></div>

<p>We get the same result when specifying the rigorous lambda manually using the
<code class="highlighter-rouge">lambda()</code> option of lassologit:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. lassologit v58 v1-v57, lambda(79.207801)
</code></pre></div></div>

<h2 id="prediction">Prediction</h2>

<p>After selecting a model, we can use predict to obtain predicted probabilities or
linear predictions.</p>

<p>First, we select a model using <code class="highlighter-rouge">lic()</code> in combination with <code class="highlighter-rouge">postresults</code> as above:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. lassologit v58 v1-v57
. lassologit, lic(ebic) postresults
</code></pre></div></div>

<p>Then, we use <code class="highlighter-rouge">predict</code>:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. predict double phat, pr
. predict double xbhat, xb
</code></pre></div></div>

<p><code class="highlighter-rouge">pr</code> saves the predicted probability of success and <code class="highlighter-rouge">xb</code> saves the linear predicted
values.</p>

<p>Note that the use of <code class="highlighter-rouge">postresults</code> is required.  Without <code class="highlighter-rouge">postresults</code> the results
of the estimation with the selected penalty level are not stored.</p>

<p>The approach for <code class="highlighter-rouge">cvlassologit</code> is very similar:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. cvlassologit v58 v1-v57
. cvlassologit, lopt postresults
. predict double phat, pr
</code></pre></div></div>

<p>In the case of <code class="highlighter-rouge">rlassologit</code>, we don’t need to select a specific penalty level and
we also don’t need to specify <code class="highlighter-rouge">postresults</code>.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. rlassologit v58 v1-v57
. predict double phat, pr
</code></pre></div></div>

<h2 id="assessing-prediction-accuracy-with-holdout">Assessing prediction accuracy with holdout()</h2>

<p>We can leave one partition of the data out of the estimation sample and check
the accuracy of prediction using the <code class="highlighter-rouge">holdout(varname)</code> option.</p>

<p>We first define a binary holdout variable:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. gen myholdout = (_n&gt;4500)
</code></pre></div></div>

<p>There are 4,601 observations in the sample, and we exclude observations 4,501 to
4,601 from the estimation. 
These observations are used to assess classification accuracy.
The holdout variable should be set to 1 for all
observations that we want to use for assessing classification accuracy.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. lassologit v58 v1-v57, holdout(myholdout)
. mat list e(loss)

. rlassologit v58 v1-v57, holdout(myholdout)
. mat list e(loss)
</code></pre></div></div>

<p>The loss measure is returned in <code class="highlighter-rouge">e(loss)</code>.  As with cross-validation, deviance is
used by default.  <code class="highlighter-rouge">lossmeasure(class)</code> will return the average number of
miss-classifications.</p>

<h2 id="plotting-with-lassologit">Plotting with lassologit</h2>

<p><code class="highlighter-rouge">lassologit</code> supports plotting of the coefficient path over <script type="math/tex">\lambda</script>.  Here, we
create the plot using the replay syntax, but the same can be achieved in one
line:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. lassologit v58 v1-v57
. lassologit, plotpath(lambda) plotvar(v1-v5) plotlabel plotopt(legend(off))
</code></pre></div></div>

<p>In the above example, we use the following settings:  <code class="highlighter-rouge">plotpath(lambda)</code> plots
estimates against lambda.  <code class="highlighter-rouge">plotvar(v1-v5)</code> restricts the set of variables plotted
to <code class="highlighter-rouge">v1-v5</code> (to avoid that the graph is too cluttered).  <code class="highlighter-rouge">plotlabel</code> puts variable
labels next to the lines.  <code class="highlighter-rouge">plotopt(legend(off))</code> turns the legend off.</p>

<h2 id="plotting-with-cvlassologit">Plotting with cvlassologit</h2>

<p>The <code class="highlighter-rouge">plotcv</code> option creates a graph of the estimates loss a function of lambda:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>. cvlassologit v58 v1-v57, nfolds(3) seed(123)
. cvlassologit v58 v1-v57, plotcv
</code></pre></div></div>

<p>The vertical solid red line indicates the value of lambda that minimizes the
loss function.  The dashed red line corresponds to the largest lambda for which
MSPE is within one standard error of the minimum loss.</p>

<h2 id="more">More</h2>

<p>More information can be found in the help file:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>help lassologit
</code></pre></div></div>

        
      </section>

      <footer class="page__meta">
        
        


        
      </footer>

      

      
    </div>

    
  </article>

  
  
</div>
    </div>

    

    <div class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    
    
    
    
    
    
    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2020 Achim Ahrens. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://use.fontawesome.com/releases/v5.0.9/js/all.js"></script>








  </body>
</html>